services:
- xvfb
- postgresql
addons:
- postgresql: '9.6'
- chrome: stable
language: ruby
rvm:
- 2.6.3
cache:
  bundler: true
  directories:
  - node_modules
  yarn: true
before_install:
- export TZ=America/Chicago
- date
- wget http://chromedriver.storage.googleapis.com/2.9/chromedriver_linux64.zip
- unzip chromedriver_linux64.zip
- rm chromedriver_linux64.zip
- sudo mv -f chromedriver /usr/local/bin/
- sudo chmod +x /usr/local/bin/chromedriver
- google-chrome-stable --headless --no-sandbox
install:
- bundle install
- node -v
- npm i -g yarn
- yarn
before_script:
- cp config/database.yml.travis config/database.yml
- bundle exec rails db:reset db:setup db:migrate RAILS_ENV=test
- bin/webpack
script:
- make lint
- make test
deploy:
  provider: heroku
  skip_cleanup: true
  api_key:
    secure: B/3X779GI74oE9nXSHubCOmgz1VXmXeJNxzwEEuimqXdGFAAJSzReFsj4m16rkZxmnB8WfCbcDytd3MWQyFFfGdGlaGCVZBhUSSO0hsU0DfTpnL6KnZePRj2s2/XCarBdI1Aav+w2hykEOVu8u1cmUdnmhLpsGS+a7T9RHBLHuaPkeXdxy7hzSlSeMgQpxTSwFQsCY5PDkVUifsCCkDh7REHA6X2XYw+LVnOrni5YkHINabtqhAcmZ0LQeVM9rKrkVDY2IIfpxRIpN4ADObmmut/sOl1S5GmMHzG9iQOjPOXbS2aDGGKdoNoMVvW7TmswEr+7o6jL4YwcTeskjTvi+TrQn0/Jj3mJJK0zg5X4zpcHj6ssHkM4aKEYD73NZGKBihqvRSy/iCnzh0LEYlU91pscbGPYLZy1tc9Ywy8NGnJujuthafocb/XXlPjkXXbzmZYQt3+idFmc7W4Z2MOwRq0v+myIzR8KCK6BcaN8pQdwjpRPgA7BfzbLeTD/omKRcKYQExt8cbYDaskH09qnoecuBQdpI+m/yLG3c3NKv9M6DSXuYtCjbY6MXq2A8xA/KkqbAhUi2inE5NEcRFtjrHPnFzGtc8k5SSTQHPVJkLe9fJfN2WO52hfBHtnPTL82KCzVRG6M3poCDk7qcIgiskMiEY8kudMO7OSHFjuhB8=
  app:
    - develop: xray-shopper-stage
    - master: xray-shopper
  on:
    repo: n8rzz/shopper
    branch:
    - develop
    - master
